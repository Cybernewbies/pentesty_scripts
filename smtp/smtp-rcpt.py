#!/usr/bin/python

import socket
import sys


if len(sys.argv) != 2:
  print("Usage: smtp-rcpt.py <username>")
  sys.exit(0)
try:
    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM) # create a socket
    connect=s.connect(('1.2.3.4',25)) # connect to the server
    banner=s.recv(1024) # receive the banner
    print("SMTP Banner: {}".format(banner.decode('utf-8')))
    from_string = "MAIL FROM: hello@gmail.com\n"
    s.sendall(from_string.encode('utf-8'))
    s.recv(1024)
    send_string = "RCPT TO:{}\n".format(sys.argv[1])
    print("trying: {}".format(sys.argv[1]))
    s.sendall(send_string.encode('utf-8')) # RCPT TO a user
    response = s.recv(1024)
    clean_response = response.decode('utf-8')
    quit_string = "QUIT \n"
    s.sendall(quit_string.encode('utf-8'))
    s.close()
    if ("250" in clean_response): # if RCPT TO is a recognized command (regardless if mailfrom user exists)
        print(clean_response)
    else:
        print('notvalid')
except Exception as e:
    print(e)
