#!/usr/bin/env python
"""subdomains via passive total

"""
__author__ = 'CG'
__version__ = '1.0.0'
__description__ = "Search passive DNS, WHOIS and SSL certificates based on keywords"
__keywords__ = ['search', 'keywords', 'analysis']

import requests
import time

#username = "--YOUR-USERNAME--"
#api_key = "--YOUR-API-KEY--"

auth = (username, api_key)
base_url = "https://api.passivetotal.org"


def passivetotal_get(path, query):
    url = base_url + path
    data = {'query': query}
    # Important: Specifying json= here instead of data= ensures that the
    # Content-Type header is application/json, which is necessary.
    response = requests.get(url, auth=auth, json=data)
    print response
    # This parses the response text as JSON and returns the data representation.
    return response.json()

#open a list of domains, look for subdomains
f = open('domains-list2.txt', 'r')

for domain in f:
	print domain
	subdomain = passivetotal_get('/v2/enrichment/subdomains', domain.strip())
	print subdomain
	for sub in subdomain['subdomains']:
		fh = open('subdomain-output.txt', 'a')
		print ('\t'+sub+'.'+domain)
		fh.writelines(sub+'.'+domain)
		fh.close()
	time.sleep(10)






